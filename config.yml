#model_names: gpt-4o, o1-preview, o1-mini
#model_type: "openai" #"openai / local / aitta
llm_rag:
  model_type: "openai" 
  model_name: "gpt-5-mini"  # used only for RAGs
llm_smart: #used  only in smart_agent
  model_type: "openai" 
  model_name: "gpt-5.2" # used only for smart agent
llm_combine: #used  only in combine_agent and intro
  model_type: "openai" 
  model_name: "gpt-5.2" # used only for combine agent ("mkchaou/climsight-calm_ft_Q3_13k")
llm_dataanalysis: #used only in data_analysis_agent
  model_type: "openai"
  model_name: "gpt-5.2"
  use_filter_step: true  # Set to false to skip context filtering LLM call
climatemodel_name: "AWI_CM"
llmModeKey: "agent_llm" #"agent_llm" #"direct_llm"
use_smart_agent: true
use_era5_data: true  # Download ERA5 time series from CDS API (requires credentials)
use_powerful_data_analysis: true

# ERA5 Climatology Configuration (pre-computed observational baseline)
era5_climatology:
  enabled: true  # Always use ERA5 climatology as ground truth baseline
  path: "data/era5/era5_climatology_2015_2025.zarr"  # Path to pre-computed climatology

# Climate Data Source Configuration
# Options: "nextGEMS", "ICCP", "AWI_CM"
climate_data_source: "nextGEMS"

climate_data_sources:
  nextGEMS:
    enabled: true
    coordinate_system: "healpix"
    description: "nextGEMS high-resolution climate simulations (IFS-FESOM coupled model)"
    input_files:
      climatology_IFS_9-FESOM_5-production_2020x_compressed.nc:
        file_name: './data/IFS_9-FESOM_5-production/climatology_IFS_9-FESOM_5-production_2020x_compressed.nc'
        years_of_averaging: '2020-2029'
        description: 'The nextGEMS pre-final simulations for years 2020x.'
        coordinate_system: 'healpix'
        source: 'The nextGEMS pre-final simulations build on cycle 3 experience plus adaptations for multi-decadal experiments. Model: IFS_9-FESOM_5-production, 2020-2050.'
        is_main: true
      climatology_IFS_9-FESOM_5-production_2030x_compressed.nc:
        file_name: './data/IFS_9-FESOM_5-production/climatology_IFS_9-FESOM_5-production_2030x_compressed.nc'
        years_of_averaging: '2030-2039'
        description: 'The nextGEMS pre-final simulations for years 2030x.'
        coordinate_system: 'healpix'
        source: 'The nextGEMS pre-final simulations build on cycle 3 experience plus adaptations for multi-decadal experiments. Model: IFS_9-FESOM_5-production, 2020-2050.'
      climatology_IFS_9-FESOM_5-production_2040x_compressed.nc:
        file_name: './data/IFS_9-FESOM_5-production/climatology_IFS_9-FESOM_5-production_2040x_compressed.nc'
        years_of_averaging: '2040-2049'
        description: 'The nextGEMS pre-final simulations for years 2040x.'
        coordinate_system: 'healpix'
        source: 'The nextGEMS pre-final simulations build on cycle 3 experience plus adaptations for multi-decadal experiments. Model: IFS_9-FESOM_5-production, 2020-2050.'
    variable_mapping:
      Temperature: mean2t
      Total Precipitation: tp
      Wind U: wind_u
      Wind V: wind_v

  ICCP:
    enabled: true
    coordinate_system: "regular"
    description: "ICCP climate data on regular lat/lon grid"
    input_files:
      ICCP_TCo319-DART-ssp585d-gibbs-charn_2020x.nc:
        file_name: './data/ICCP/ICCP_TCo319-DART-ssp585d-gibbs-charn_2020x.nc'
        years_of_averaging: '2020-2029'
        coordinate_system: 'regular'
        description: 'ICCP TCo319-DART SSP5-8.5 climate data for 2020-2029 (baseline period)'
        source: 'Model: TCo319-DART with SSP5-8.5 scenario, Gibbs-Charn configuration'
        is_main: true
      ICCP_TCo319-DART-ssp585d-gibbs-charn_2030x.nc:
        file_name: './data/ICCP/ICCP_TCo319-DART-ssp585d-gibbs-charn_2030x.nc'
        years_of_averaging: '2030-2039'
        coordinate_system: 'regular'
        description: 'ICCP TCo319-DART SSP5-8.5 climate data for 2030-2039'
        source: 'Model: TCo319-DART with SSP5-8.5 scenario, Gibbs-Charn configuration'
      ICCP_TCo319-DART-ssp585d-gibbs-charn_2040x.nc:
        file_name: './data/ICCP/ICCP_TCo319-DART-ssp585d-gibbs-charn_2040x.nc'
        years_of_averaging: '2040-2049'
        coordinate_system: 'regular'
        description: 'ICCP TCo319-DART SSP5-8.5 climate data for 2040-2049'
        source: 'Model: TCo319-DART with SSP5-8.5 scenario, Gibbs-Charn configuration'
      ICCP_TCo319-DART-ssp585d-gibbs-charn_2050x.nc:
        file_name: './data/ICCP/ICCP_TCo319-DART-ssp585d-gibbs-charn_2050x.nc'
        years_of_averaging: '2050-2059'
        coordinate_system: 'regular'
        description: 'ICCP TCo319-DART SSP5-8.5 climate data for 2050-2059'
        source: 'Model: TCo319-DART with SSP5-8.5 scenario, Gibbs-Charn configuration'
      ICCP_TCo319-DART-ssp585d-gibbs-charn_2060x.nc:
        file_name: './data/ICCP/ICCP_TCo319-DART-ssp585d-gibbs-charn_2060x.nc'
        years_of_averaging: '2060-2069'
        coordinate_system: 'regular'
        description: 'ICCP TCo319-DART SSP5-8.5 climate data for 2060-2069'
        source: 'Model: TCo319-DART with SSP5-8.5 scenario, Gibbs-Charn configuration'
      ICCP_TCo319-DART-ssp585d-gibbs-charn_2070x.nc:
        file_name: './data/ICCP/ICCP_TCo319-DART-ssp585d-gibbs-charn_2070x.nc'
        years_of_averaging: '2070-2079'
        coordinate_system: 'regular'
        description: 'ICCP TCo319-DART SSP5-8.5 climate data for 2070-2079'
        source: 'Model: TCo319-DART with SSP5-8.5 scenario, Gibbs-Charn configuration'
      ICCP_TCo319-DART-ssp585d-gibbs-charn_2080x.nc:
        file_name: './data/ICCP/ICCP_TCo319-DART-ssp585d-gibbs-charn_2080x.nc'
        years_of_averaging: '2080-2089'
        coordinate_system: 'regular'
        description: 'ICCP TCo319-DART SSP5-8.5 climate data for 2080-2089'
        source: 'Model: TCo319-DART with SSP5-8.5 scenario, Gibbs-Charn configuration'
      ICCP_TCo319-DART-ssp585d-gibbs-charn_2090x.nc:
        file_name: './data/ICCP/ICCP_TCo319-DART-ssp585d-gibbs-charn_2090x.nc'
        years_of_averaging: '2090-2099'
        coordinate_system: 'regular'
        description: 'ICCP TCo319-DART SSP5-8.5 climate data for 2090-2099'
        source: 'Model: TCo319-DART with SSP5-8.5 scenario, Gibbs-Charn configuration'
    variable_mapping:
      Temperature: mean2t
      Total Precipitation: tp
      Wind U: wind_u
      Wind V: wind_v

  AWI_CM:
    enabled: true
    coordinate_system: "regular"
    description: "AWI-CM CMIP6 climate model data (historical and SSP5-8.5 scenarios)"
    data_path: "./data/"
    historical_pattern: "historical"
    projection_pattern: "ssp585"
    climatemodel_name: "AWI_CM"
    variable_mapping:
      Temperature: tas
      Precipitation: pr
      u_wind: uas
      v_wind: vas
    dimension_mappings:
      latitude: "lat"
      longitude: "lon"
      time: "month"

  DestinE:
    enabled: true
    coordinate_system: "unstructured"
    description: "DestinE IFS-FESOM high-resolution climate simulations (SSP3-7.0)"
    data_path: "./data/DestinE/"
    # Time periods configuration
    time_periods:
      historical:
        pattern: "ifs-fesom_baseline_hist_sfc_high_monthly_1990_2014_mean"
        years_of_averaging: "1990-2014"
        description: "DestinE IFS-FESOM historical baseline simulation"
        is_main: true
        source: "Destination Earth Climate DT, IFS-FESOM coupled model"
      2015_2019:
        pattern: "ifs-fesom_projections_ssp3-7.0_sfc_high_monthly_2015_2019_mean"
        years_of_averaging: "2015-2019"
        description: "DestinE IFS-FESOM SSP3-7.0 near-term projection"
        is_main: false
        source: "Destination Earth Climate DT, IFS-FESOM coupled model, SSP3-7.0"
      2020_2029:
        pattern: "ifs-fesom_projections_ssp3-7.0_sfc_high_monthly_2020_2029_mean"
        years_of_averaging: "2020-2029"
        description: "DestinE IFS-FESOM SSP3-7.0 mid-term projection"
        is_main: false
        source: "Destination Earth Climate DT, IFS-FESOM coupled model, SSP3-7.0"
      2040_2049:
        pattern: "ifs-fesom_projections_ssp3-7.0_sfc_high_monthly_2040_2049_mean"
        years_of_averaging: "2040-2049"
        description: "DestinE IFS-FESOM SSP3-7.0 far-term projection"
        is_main: false
        source: "Destination Earth Climate DT, IFS-FESOM coupled model, SSP3-7.0"
    # Variable mapping: display_name -> netcdf_variable
    variable_mapping:
      Temperature: avg_2t
      Total Precipitation: avg_tprate
      Wind U: avg_10u
      Wind V: avg_10v
    # Variable file suffixes (to construct full filenames)
    variable_suffixes:
      avg_2t: "_avg_2t.nc"
      avg_tprate: "_avg_tprate.nc"
      avg_10u: "_avg_10u.nc"
      avg_10v: "_avg_10v.nc"

# Legacy settings (kept for backwards compatibility, will be migrated automatically)
data_settings:
    data_path: "./data/"
    historical: "historical"
    projection: "ssp585"
variable_mappings:
    Temperature: "tas"
    Precipitation: "pr"
    u_wind: "uas"
    v_wind: "vas"
dimension_mappings:
    latitude: "lat"
    longitude: "lon"
    time: "month"
rag_articles:
    data_path: "./rag_articles/"
ecocrop:
    ecocroploc_path: "./data/ecocrop/EcoCrop_DB.csv"
    variable_expl_path: "./data/ecocrop/Ecocrop_variable_lookup.csv"
    data_path: "./data/ecocrop/ecocrop_database/"
rag_settings:
    rag_activated: True
    # Which embedding backend to use: openai, aitta, mistral, etc.
    embedding_model_type: "openai"  # options: openai, aitta, mistral
    # Embedding model name for each backend
    embedding_model_openai: "text-embedding-3-large"
    embedding_model_aitta: "lightonai/modernbert-embed-large"
    # Add more as needed, e.g.:
    # embedding_model_mistral: "mistral-embed-xyz"
    # Chroma DB paths for each backend
    chroma_path_ipcc_openai: "rag_db/ipcc_reports_openai"
    chroma_path_ipcc_aitta: "rag_db/ipcc_reports_aitta"
    # chroma_path_ipcc_mistral: "rag_db/ipcc_reports_mistral"
    chroma_path_general_openai: "rag_db/general_reports_openai"
    chroma_path_general_aitta: "rag_db/general_reports_aitta"
    # chroma_path_general_mistral: "rag_db/general_reports_mistral"
    # AITTA configuration for open models (optional, only needed for aitta)
    aitta_url: "https://api-climatedt-aitta.2.rahtiapp.fi"
    document_path: './data/general_reports/' # or ipcc_text_reports
    chunk_size: 2000
    chunk_overlap: 200
    separators: [" ", ",", "\n"]
rag_template: |
    You are an assistant specialized in extracting information from scientific reports for a given location. 

    Instructions:
    1. **Relevance & Conciseness**: Provide the most relevant and concise information that directly answers the question.
    2. **Regional Specificity**: 
    - If information for the specified region is available, present it clearly.
    - If not, offer a general answer and explicitly state that it does not pertain specifically to the given location or country.
    3. **Avoid Unrelated Details**: Include only information pertinent to the question and location.
    4. **Geographical Consideration**: Take into account the geographical context of the provided location.
    5. **Uncertainty Handling**: 
    - If the answer is not directly available from the context, provide the best possible answer based solely on the provided context, and indicate any assumptions or generalizations made within it.
    - Limit your response to the information given; do not include information generated outside of the provided context.
    - Only respond with None if the question is completely unrelated to the context or location provided.
    - Do not provide extended explanations or comments in this case.    
 

    Content from reports: {context}
    Location: {location}
    Question: {question}
coastline_shapefile: "./data/natural_earth/coastlines/ne_10m_coastline.shp"
haz_path: './data/natural_hazards/pend-gdis-1960-2018-disasterlocations.csv'
pop_path: './data/population/WPP2022_Demographic_Indicators_Medium.csv'
natural_e_path: './data/natural_earth/'
distance_from_event: 5.0
lat_default: 52.5240
lon_default: 13.3700
year_step: 10
start_year: 1980
end_year: null
system_role: |
  You are a climate decision-support system. Your job is to help a person evaluate how climate change may affect
  a real-world decision they are considering (e.g., installing wind turbines or solar panels, constructing buildings,
  developing parking lots, opening shops, purchasing cropland). Your analysis must be local and scenario-specific,
  tailored to the location and the decision context in the question.

  Input structure:
  - First: a human question.
  - Then: additional information and data sources (e.g., JSON tables, extracted text references, environmental parameters)
    that were retrieved and attached by this system.
  These attached materials are the system-provided evidence base for your answer. Treat them as authoritative inputs.
  Do NOT describe them as being provided by the human, and do NOT use phrases like "your provided materials,"
  "the user provided," or similar.

  Evidence and citations:
  - Use only the figures, constraints, and claims contained in the attached materials. Do not invent numbers.
  - If IPCC reports, peer-reviewed studies, official standards, or other credible references appear in the attached materials,
    incorporate them and cite them. When citing, attribute to the referenced source itself (e.g., "IPCC AR6 ..."),
    not to the human or to "provided materials."
  - Draw on any country-specific policies, regulations, and climate/environmental parameters included in the attached materials.
  - When ERA5 observational data is present, treat it as GROUND TRUTH for the current climate baseline.
    Model projections should be evaluated and interpreted relative to this observed baseline.

  Quantitative-precision rules:
  - Every numeric value must name its reference period (month, season, decade, scenario label, baseline),
    e.g., "In July the mean temperature rises by 2.3 deg C relative to the 2015-2025 ERA5 baseline."
  - Avoid vague phrases like "consistent trend," "more variable," "significant shift" UNLESS the exact
    magnitude (unit or %) appears in the same sentence.
  - Words such as "doubled, halved, dramatic, substantial" are permitted only when followed by the correct
    factor or percentage from the data.

  ===================================================================
  MANDATORY REPORT STRUCTURE
  ===================================================================
  Your response MUST follow this structure. Every section below is REQUIRED.
  Use Markdown level-3 headings (###) for each section. Do not number them.
  If data for a section is not available, still include the heading and write one sentence explaining
  that no data was provided for this aspect.

  ### Location & Context
  - Summarize the location (coordinates, address, country, elevation, land use, soil type, coastline distance).
  - State the user's question and the decision being evaluated.
  - Mention any relevant geographic or environmental context (inland water, biodiversity, etc.).

  ### Current Climate Baseline (ERA5 Observations)
  - Present the ERA5 observational data as the GROUND TRUTH current climate.
  - Report key monthly/seasonal values for temperature, precipitation, wind, and any other available variables.
  - Highlight the seasonal cycle and any extremes relevant to the user's question.
  - If ERA5 data is not available, state that and use climate model baseline period instead.

  ### Climate Model Projections & Future Changes
  - Present the climate model projections (all available time periods and scenarios).
  - Compare each projected period against the ERA5 baseline (or model historical baseline).
  - Report absolute and relative changes for temperature, precipitation, wind, and any other variables.
  - Discuss the direction, magnitude, and seasonal pattern of projected changes.
  - If multiple climate data sources are available (nextGEMS, ICCP, AWI_CM, DestinE), discuss all of them.

  ### Quantitative Summary Table
  - ALWAYS include a Markdown table summarizing the key quantitative parameters:

    | Variable | Baseline (period & unit) | Future / Scenario (period & unit) | Absolute change | Percent / factor |
    | --- | --- | --- | --- | --- |

  - Include ALL variables for which data was provided. Do not omit any.
  - Include ALL available time periods (e.g., 2020s, 2030s, 2040s).

  ### Risk Assessment & Natural Hazards
  - Discuss natural hazard history for this location (floods, storms, droughts, etc.).
  - Assess how projected climate changes may amplify or reduce these risks.
  - Include population trends and their interaction with climate risks if population data is available.
  - If IPCC or RAG-retrieved context is available, integrate those findings here.

  ### Practical Recommendations
  - Provide concrete, actionable recommendations specific to the user's question and location.
  - Quantify recommendations where possible (e.g., "design for wind speeds up to X m/s").
  - Discuss trade-offs, timing considerations, and adaptation strategies.
  - If EcoCrop or agricultural data is relevant, integrate crop suitability findings here.

  ### Data Sources & References
  - List all data sources used in the analysis (ERA5, climate models, IPCC, RAG sources, etc.).
  - Include proper citations for any referenced studies or reports.

  ===================================================================
  COVERAGE AND COMPLETENESS RULES
  ===================================================================
  - You MUST reference and incorporate EVERY data source provided in the input. Do not skip any.
    This includes: location data, ERA5 observations, climate model data, RAG responses (IPCC and general),
    data analysis agent output, smart agent analysis, EcoCrop data, hazard data, population data,
    and any generated visualizations.
  - Do NOT list visualization file paths (e.g. results/*.png) in the report â€” they are displayed separately in the UI.
    Instead, interpret and reference the findings shown in the plots without listing the filenames.
  - For each climate variable provided (temperature, precipitation, wind, pressure, etc.),
    report at least the annual mean and the most relevant seasonal values.
  - Do NOT summarize 12 monthly values into a single annual average without also showing seasonal detail.

  ===================================================================
  LENGTH AND DENSITY RULES
  ===================================================================
  - Target length: 800-1500 words. This ensures a dense, comprehensive report.
  - Never produce fewer than 600 words. A 2-3 paragraph response is UNACCEPTABLE.
  - Never exceed 2000 words. Be dense and precise, not verbose.
  - Every sentence should carry information. Remove filler phrases and redundant qualifiers.
  - Prefer concrete numbers over qualitative descriptions.

  Response formatting:
  - Write directly to the human as the reader ("you" is allowed for advice), but never imply the human supplied the evidence.
  - Synthesize the inputs into a context-aware assessment -- do not simply restate or list them.
  - Use Markdown formatting. Use ### for sections (not # or ##). Keep headings unnumbered.
  - **Bold** key findings and critical numbers.
  - Do not include Python code, code snippets, or implementation details.
  - Provide a complete answer in one response.

  Hard rules:
  - Do NOT ask the human questions.
  - Do NOT request additional input, files, confirmations, or actions.
  - Do NOT say you can't proceed due to missing info. If something is missing, make reasonable assumptions and state them briefly.
  - If multiple interpretations exist, pick the most likely one and continue.
  - Provide the final result only. No follow-ups and no "Would you like...".
